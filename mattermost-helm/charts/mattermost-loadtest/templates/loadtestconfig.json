{{- define "loadtestconfig.json" -}}
{
    "ConnectionConfiguration": {
        "ServerURL": "http://{{ .Release.Name }}-nginx-ingress-controller",
        "WebsocketURL": "ws://{{ .Release.Name }}-nginx-ingress-controller",
        "PProfUrl": "http://{{ .Release.Name }}-mattermost-app:8067/debug/pprof",
        {{- if eq .Values.global.dbBackend "mysqlha" -}}
        "DriverName": "mysql",
        "DataSource": "{{ .Values.global.dbUser }}:{{ .Values.global.dbPassword }}@tcp({{ .Release.Name }}-mysqlha-0.{{ .Release.Name }}-mysqlha:3306)/{{ .Values.global.dbName }}?charset=utf8mb4,utf8&readTimeout=240s&writeTimeout=240s",
        {{- end -}}
        {{- if eq .Values.global.dbBackend "postgresql" -}}
        "DriverName": "postgres",
        "DataSource": "postgres://{{ .Values.global.dbUser }}:{{ .Values.global.dbPassword }}@{{ .Release.Name }}-postgresql:5432/{{ .Values.global.dbName }}?sslmode=disable&connect_timeout=10",
        {{- end -}}
        "LocalCommands": true,
        "SSHHostnamePort": "",
        "SSHUsername": "",
        "SSHPassword": "",
        "SSHKey": "",
        "MattermostInstallDir": "/mattermost",
        "ConfigFileLoc": "",
        "AdminEmail": "success+ltadmin@simulator.amazonses.com",
        "AdminPassword": "ltpassword",
        "SkipBulkload": {{ .Values.skipBulkLoad }},
        "WaitForServerStart": true
    },
    "LoadtestEnviromentConfig": {
        "NumTeams": {{ .Values.numTeams }},
        "NumChannelsPerTeam": {{ .Values.numChannelsPerTeam }},
        "NumUsers": {{ .Values.numUsers }},
        "NumPosts": {{.Values.numPosts}},
        "NumEmoji": {{.Values.numEmoji}},
        "PostTimeRange": 2600000,
        "ReplyChance": {{.Values.replyChance}},
        "PercentHighVolumeTeams": 0.2,
        "PercentMidVolumeTeams": 0.5,
        "PercentLowVolumeTeams": 0.3,
        "PercentUsersHighVolumeTeams": 0.9,
        "PercentUsersMidVolumeTeams": 0.5,
        "PercentUsersLowVolumeTeams": 0.1,
        "PercentHighVolumeChannels": 0.2,
        "PercentMidVolumeChannels": 0.5,
        "PercentLowVolumeChannels": 0.3,
        "PercentUsersHighVolumeChannel": 0.1,
        "PercentUsersMidVolumeChannel": 0.003,
        "PercentUsersLowVolumeChannel": 0.0002,
        "HighVolumeTeamSelectionWeight": 3,
        "MidVolumeTeamSelectionWeight": 2,
        "LowVolumeTeamSelectionWeight": 1,
        "HighVolumeChannelSelectionWeight": 1,
        "MidVolumeChannelSelectionWeight": 3,
        "LowVolumeChannelSelectionWeight": 1
    },
    "UserEntitiesConfiguration": {
        "TestLengthMinutes": {{ .Values.testLengthMinutes }},
        "NumActiveEntities": {{ .Values.numActiveEntities }},
        "EntityStartNum": 0,
        "ActionRateMilliseconds": {{ .Values.actionRateMilliseconds }},
        "ActionRateMaxVarianceMilliseconds": {{ .Values.actionRateMaxVarianceMilliseconds }},
        "EnableRequestTiming": true,
        "UploadImageChance": 0.01,
        "LinkPreviewChance": {{ .Values.linkPreviewChance }},
        "CustomEmojiChance": {{ .Values.customEmojiChance }},
        "DoStatusPolling": true
    },
    "DisplayConfiguration": {
        "ShowUI": false,
        "LogToConsole": true
    },
    "ResultsConfiguration": {
        "CustomReportText": "Results for #{{ .Release.Name }}",
        "SendReportToMMServer": {{ .Values.sendReportToMMServer }},
        "ResultsServerURL": "{{ .Values.resultsServerUrl }}",
        "ResultsChannelId": "{{ .Values.resultsChannelId }}",
        "ResultsUsername": "{{ .Values.resultsUsername }}",
        "ResultsPassword": "{{ .Values.resultsPassword }}",
        "PProfDelayMinutes": {{ .Values.pprofDelayMinutes }},
        "PProfLength": {{ .Values.pprofLengthSeconds }}
    }
}
{{- end -}}
